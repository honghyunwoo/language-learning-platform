# 궁극의 마스터 플랜: 현재부터 미래까지
## 무료 영어 회화 학습 플랫폼 - 완전 종합 전략

> **비전**: "돈이 없어도 누구나 영어를 배울 수 있는 세상"
>
> **미션**: 듀오링고보다 효과적이고, 완전 무료인 영어 회화 학습 플랫폼 구축
>
> **목표**: 웹 → PWA → 네이티브 앱 → 글로벌 1억 사용자

---

## 📊 시장 조사 결과 (2025년 기준)

### 언어 학습 앱 시장 현황

#### 시장 규모
- **2023년 매출**: $1.08 billion (약 1.4조원)
- **2031년 예상**: $16.63 billion (약 22조원)
- **연평균 성장률**: 16.38% CAGR

#### 시장 리더 분석

**1. Duolingo**:
- 2023년 매출: $531 million (약 7,000억원)
- 전체 시장의 50% 점유
- 사용량의 60% 차지
- **핵심**: 무료 버전에도 모든 레슨 제공
- **수익**: 프리미엄 구독 72% + 광고 28%
- **프리미엄 가격**: $30/월

**2. 사용자 유지율 문제**:
- 언어 학습 앱 평균 유지율: **1.76%** (가장 낮음)
- 이유: 장기간 학습 필요, 진전 느림
- **Duolingo 해결책**: 게임화로 유지율 향상
  - 2020년 이탈률: 47%
  - 2022년 이탈률: 37% (10% 개선)
  - Power User: 20% → 30%

#### 성공 요인
- **평균 매출**: $493K/년
- **평균 마진**: 83% (매우 높음)
- **핵심**: 게임화 + 커뮤니티 + 일일 스트릭

---

## 🎯 우리의 차별화 전략 (상세)

### 1. 완전 무료 전략 (Free Forever)

#### 왜 완전 무료인가?
- **사회적 영향**: 경제적 어려움 때문에 영어를 못 배우는 사람들 지원
- **시장 진입**: 빠른 사용자 확보 (Duolingo도 무료로 시작)
- **입소문**: "정말 무료인데 이 정도면 대박"
- **경쟁 우위**: $30/월 유료 기능을 무료로 제공

#### 무료로 제공하는 것들
| 기능 | 경쟁사 가격 | 우리 |
|------|-----------|------|
| AI 대화 연습 | $15-30/월 | **무료** |
| 체계적 커리큘럼 (A1-B2) | $15/월 | **무료** |
| 게임화 시스템 | 무료 (제한적) | **무료 (풀버전)** |
| 발음 듣기 (TTS) | 무료 | **무료 (강화)** |
| 커뮤니티 학습 | 제한적 | **무료 (풀버전)** |
| 진도 추적/통계 | $30/월 | **무료** |
| 모바일 앱 | 유료 | **무료** |

### 2. 회화 실력 최우선 설계

#### 실생활 중심 콘텐츠
- **시나리오**: 카페 주문, 길 묻기, 쇼핑, 병원, 직장, 여행
- **자연스러운 표현**: 교과서 영어 ❌, 원어민 표현 ✅
- **즉각 피드백**: 왜 이 표현이 더 자연스러운지 설명
- **문화적 팁**: 미국/영국 문화 차이, 예절

#### 대화 시뮬레이션 (핵심 차별화)
```
사용자 경험:
1. 실제 상황 선택 (카페 주문)
2. AI 캐릭터와 대화
3. 3가지 선택지 (완벽/괜찮음/틀림)
4. 즉시 피드백 + 점수
5. 다음 턴 진행
6. 완료 후 복습 + 학습 포인트 정리
```

**경쟁 우위**:
- Duolingo: AI 대화 $30/월
- TalkPal/Loora: AI 대화 $15-30/월
- **우리**: 무료 + 더 체계적

### 3. 게임화 강화 (Duolingo보다 더)

#### Duolingo의 성공 요소
- **일일 스트릭**: 매일 학습 동기 부여
- **포인트/뱃지**: 성취감
- **리더보드**: 경쟁심
- **조기 성취**: 초반에 빠른 보상

#### 우리의 개선점
| 요소 | Duolingo | 우리의 개선 |
|------|---------|-----------|
| **스트릭** | 기본 | + 스트릭 프리즈 무료, 복구 1회 무료 |
| **XP** | 기본 | + Weekly/Monthly 챌린지, 그룹 목표 |
| **뱃지** | 10개 정도 | + 30개 (다양한 카테고리) |
| **리더보드** | 주간 | + 전체, 친구, 그룹별 리더보드 |
| **레벨** | 없음 | + 사용자 레벨 1-100, 칭호 시스템 |
| **커뮤니티** | 제한적 | + 학습일지 공유, 스터디 그룹, 친구 응원 |

#### 초기 성취 시스템
- 1일차: "First Day" 뱃지 (즉시 보상)
- 3일차: "3 Day Warrior" 뱃지
- 7일차: "Week Master" 뱃지 + 특별 칭호
- 첫 Activity 완료: 20 XP + "Quick Learner" 뱃지
- 첫 대화 시뮬레이션: 50 XP + "Conversationalist" 뱃지

### 4. 커뮤니티 학습 (Social Learning)

#### 왜 커뮤니티가 중요한가?
- **동기 유지**: 혼자보다 함께 배우면 이탈률 ↓
- **실전 연습**: 다른 학습자와 영어로 대화
- **무료 튜터**: 고급 학습자가 초급자 도움
- **입소문**: 친구 초대 시스템

#### 커뮤니티 기능
1. **스터디 그룹**:
   - 그룹 생성 (주제, 목표, 레벨)
   - 그룹 챌린지 (함께 1000 XP 달성)
   - 그룹 채팅 (영어 사용 권장)
   - 그룹 리더보드

2. **학습 일지 공유**:
   - 오늘 배운 표현
   - 성취 자랑
   - 어려운 부분 질문
   - 좋아요/댓글

3. **친구 시스템**:
   - 친구 코드로 초대
   - 친구 순위 비교
   - 친구 응원 메시지
   - 친구 초대 보상 (뱃지, XP)

4. **언어 교환** (미래 기능):
   - 영어 배우는 한국인 ↔ 한국어 배우는 외국인
   - 30분 영어 / 30분 한국어
   - 무료 실전 회화 연습

---

## 🚀 기술 스택 및 아키텍처

### 현재 스택 (웹)
```yaml
프론트엔드:
  - Next.js 15.5.4 (App Router)
  - React 19.1.0
  - TypeScript 5 (strict mode)
  - Tailwind CSS

백엔드/데이터베이스:
  - Firebase Firestore (NoSQL)
  - Firebase Authentication
  - Firebase Admin SDK
  - Firebase Security Rules

상태 관리:
  - React Query (TanStack Query)
  - React Context API
  - Custom Hooks

UI/UX:
  - Chart.js (데이터 시각화)
  - Framer Motion (애니메이션)
  - Radix UI (접근성)

오디오:
  - Web Speech API (TTS)
  - Web Audio API (음성 처리)

성능:
  - Next.js Image Optimization
  - Dynamic Imports (코드 스플리팅)
  - Service Worker (오프라인)
```

### PWA 전환 (Phase 1: 웹 → PWA)

#### 왜 PWA인가?
- **설치 가능**: 홈 화면에 추가 (앱처럼 사용)
- **오프라인**: Service Worker로 오프라인 학습
- **빠른 속도**: 캐싱으로 로딩 시간 단축
- **Push 알림**: 학습 알림 가능
- **하나의 코드베이스**: 웹 + 모바일
- **비용 절감**: 네이티브 앱 개발 불필요

#### PWA 구현 계획 (15-20시간)

**Task 1: next-pwa 설정 (3-4시간)**:
```bash
npm install next-pwa
```

```javascript
// next.config.js
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development'
});

module.exports = withPWA({
  // 기존 설정
});
```

**Task 2: manifest.json 작성 (2-3시간)**:
```json
{
  "name": "영어 회화 마스터",
  "short_name": "회화마스터",
  "description": "완전 무료 영어 회화 학습 플랫폼",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#4F46E5",
  "icons": [
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

**Task 3: Service Worker 구현 (4-5시간)**:
- 오프라인 캐싱 전략
- Activity 데이터 로컬 저장
- 온라인 복귀 시 동기화
- 백그라운드 동기화

**Task 4: 아이콘 디자인 (2-3시간)**:
- 192x192, 512x512 PWA 아이콘
- Favicon
- Apple Touch Icon
- 스플래시 스크린

**Task 5: 설치 프롬프트 (2-3시간)**:
```typescript
// components/InstallPrompt.tsx
const InstallPrompt = () => {
  const [installPrompt, setInstallPrompt] = useState(null);

  useEffect(() => {
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      setInstallPrompt(e);
    });
  }, []);

  const handleInstall = async () => {
    if (!installPrompt) return;
    installPrompt.prompt();
    const result = await installPrompt.userChoice;
    if (result.outcome === 'accepted') {
      // 설치 완료
    }
  };

  return (
    <button onClick={handleInstall}>
      앱으로 설치하기
    </button>
  );
};
```

**Task 6: 테스트 (2-3시간)**:
- Lighthouse PWA 점수 90+ 달성
- 오프라인 기능 테스트
- 설치 플로우 테스트
- iOS Safari 테스트 (제한사항 확인)

### 네이티브 앱 전환 (Phase 2: PWA → Native)

#### 왜 네이티브 앱이 필요한가?
- **앱 스토어 노출**: 검색 유입 증가
- **신뢰도**: "진짜 앱" 인식
- **푸시 알림**: iOS에서 더 안정적
- **성능**: 네이티브 기능 활용
- **수익화**: 인앱 결제 (나중에)

#### 전환 전략: 3가지 옵션

**옵션 1: Bubblewrap (Android만, 가장 빠름)**

**장점**:
- 무료
- 1-2일 작업
- PWA 그대로 사용

**단점**:
- Android만 가능
- iOS 불가

**구현**:
```bash
npm install -g @bubblewrap/cli
bubblewrap init --manifest https://yourapp.com/manifest.webmanifest
bubblewrap build
```

**예상 시간**: 8-12시간
- 초기 설정: 3-4시간
- 빌드 및 테스트: 3-4시간
- Google Play 등록: 2-4시간

---

**옵션 2: Capacitor (Android + iOS, 추천)**

**장점**:
- Android + iOS 모두 지원
- 네이티브 플러그인 사용 가능
- 무료 오픈소스
- Next.js와 잘 호환

**단점**:
- Bubblewrap보다 복잡
- iOS 빌드는 Mac 필요

**구현**:
```bash
npm install @capacitor/core @capacitor/cli
npx cap init
npx cap add android
npx cap add ios
```

**예상 시간**: 40-60시간
- Capacitor 설정: 8-10시간
- Android 빌드: 10-15시간
- iOS 빌드: 15-20시간 (Mac 필요)
- 스토어 등록: 7-15시간

---

**옵션 3: React Native (완전 새로 작성, 가장 강력)**

**장점**:
- 최고 성능
- 네이티브 기능 100% 활용
- 장기적으로 가장 좋음

**단점**:
- 처음부터 다시 작성
- 100+ 시간 소요
- 유지보수 2배

**예상 시간**: 200-300시간

---

#### 추천 전략: 단계별 접근

**1단계 (MVP 출시 후 3개월)**:
- PWA로 시작
- 사용자 피드백 수집
- 웹 최적화

**2단계 (6개월 후)**:
- Bubblewrap으로 Android 앱 출시
- Google Play 등록
- Android 사용자 확보

**3단계 (1년 후)**:
- Capacitor로 iOS 앱 출시
- App Store 등록
- 전체 모바일 커버

**4단계 (2년 후, 사용자 100만+)**:
- React Native로 완전 재작성
- 최고 성능
- 글로벌 확장

---

## 💰 수익화 전략 (장기)

### 핵심 원칙
1. **무료가 우선**: 모든 핵심 기능 무료
2. **광고 없음**: 학습 방해 금지
3. **윤리적 수익**: 사용자 이익 우선
4. **투명성**: 수익 사용처 공개

### 수익화 모델 (우선순위별)

#### Phase 1: 순수 무료 (0-1년차)
- **목표**: 사용자 10만명 확보
- **수익**: $0
- **투자**: 개인 시간, 클라우드 비용 최소화 (Firebase 무료 티어)

#### Phase 2: 선택적 프리미엄 (1-2년차)

**프리미엄 기능 (월 $4.99, Duolingo의 1/6 가격)**:
- 광고 없음 (아직 광고 없지만)
- 고급 통계 (더 상세한 분석)
- 우선 지원
- 특별 뱃지
- 프리미엄 전용 대화 시나리오 (월 5개 추가)
- 오프라인 다운로드 무제한
- **핵심 학습 기능은 여전히 무료**

**예상 전환율**: 2-3% (Duolingo 수준)
- 사용자 10만명 × 2.5% = 2,500명
- 2,500명 × $4.99 = **$12,475/월** (약 1,600만원/월)

#### Phase 3: B2B 파트너십 (2-3년차)

**학교/기업 패키지**:
- 학교: 학생 전체 계정 + 선생님 대시보드
- 기업: 직원 영어 교육 패키지
- 가격: 사용자당 $2-3/월 (대량 할인)

**예상 수익**:
- 학교 10개 (각 500명) = 5,000명 × $2 = **$10,000/월**
- 기업 5개 (각 100명) = 500명 × $3 = **$1,500/월**
- 총 **$11,500/월** (약 1,500만원/월)

#### Phase 4: 코스 마켓플레이스 (3년차+)

**사용자 제작 콘텐츠**:
- 고급 학습자가 코스 제작
- 판매 수익 70% (제작자) / 30% (플랫폼)
- 예: "비즈니스 영어 30일 코스" $9.99

**플랫폼 수익**:
- 월 100개 코스 판매 × $9.99 × 30% = **$300/월**
- 성장하면 더 커질 수 있음

#### Phase 5: API/데이터 라이선스 (4년차+)

**데이터 자산**:
- 수백만 개의 학습 데이터
- AI 학습용 대화 데이터
- 발음 데이터
- 라이선스 판매 (익명화)

### 총 예상 수익 (3년차)

| 수익원 | 월 수익 | 연 수익 |
|--------|---------|---------|
| 프리미엄 구독 | $12,475 | $149,700 |
| B2B 파트너십 | $11,500 | $138,000 |
| 코스 마켓플레이스 | $300 | $3,600 |
| **총계** | **$24,275** | **$291,300** |

**한화**: 약 **3.8억원/년** (1달러 = 1,300원 기준)

**순이익** (마진 83%):
- $291,300 × 83% = **$241,779/년** (약 3.1억원/년)

---

## 📅 완전 타임라인 (현재 → 3년 후)

### Year 0: MVP 개발 및 출시 (현재 ~ 6개월)

#### Month 1-2: 핵심 기능 개발
- **Week 1-2**: Phase 1 (레벨 테스트) 완료
- **Week 3-6**: Phase 2 (Week 1-2 Activity) 완료
- **Week 7-8**: Phase 3 (대화 시뮬레이션 5개) 완료

#### Month 3-4: 게임화 및 커뮤니티
- **Week 9-10**: Phase 4 (게임화 시스템) 완료
- **Week 11-12**: Phase 5 (맞춤형 학습 경로) 완료
- **Week 13-14**: Phase 7 (커뮤니티 기능) 완료
- **Week 15-16**: Phase 8 (알림 시스템) 완료

#### Month 5: PWA 전환 및 최적화
- **Week 17-18**: PWA 구현
- **Week 19-20**: 성능 최적화 (Lighthouse 90+)

#### Month 6: 베타 테스트 및 출시
- **Week 21-22**: 베타 테스터 50명 모집
- **Week 23**: 피드백 반영
- **Week 24**: 공식 출시 🚀

**목표**:
- ✅ 레벨 테스트 작동
- ✅ Week 1-2 고품질 Activity
- ✅ 대화 시뮬레이션 5개
- ✅ 게임화 시스템
- ✅ PWA 설치 가능
- 🎯 첫 1,000명 사용자

---

### Year 1: 사용자 확보 및 콘텐츠 확장 (Month 7-18)

#### Q1 (Month 7-9): 콘텐츠 확장
- Week 3-4 Activity 제작 (50-60시간)
- Week 5-6 Activity 제작 (50-60시간)
- 대화 시뮬레이션 10개 추가
- 총 **20개 대화 시나리오**

#### Q2 (Month 10-12): Week 7-8 완성
- Week 7-8 Activity 제작
- **전체 8주 커리큘럼 완성** ✅
- 대화 시뮬레이션 20개 달성

#### Q3 (Month 13-15): 마케팅 및 성장
- 블로그 콘텐츠 (SEO)
- YouTube 채널 시작
- 인스타그램/틱톡 숏폼
- 커뮤니티 이벤트 (챌린지)

#### Q4 (Month 16-18): Android 앱 출시
- Bubblewrap으로 Android 앱 빌드
- Google Play 등록
- Android 마케팅

**Year 1 목표**:
- 🎯 사용자 **10만명** (월 1만명 성장)
- 📱 Android 앱 출시
- 📚 전체 8주 커리큘럼 + 20개 대화
- 📈 일일 활성 사용자(DAU) 5,000명
- 🔥 평균 스트릭 15일

---

### Year 2: 수익화 시작 및 iOS 진출 (Month 19-30)

#### Q1 (Month 19-21): 프리미엄 기능 개발
- 고급 통계 대시보드
- 프리미엄 전용 대화 10개
- 오프라인 다운로드
- 결제 시스템 연동 (Stripe)

#### Q2 (Month 22-24): iOS 앱 출시
- Capacitor로 iOS 빌드 (Mac 필요)
- App Store 등록
- iOS 마케팅

#### Q3 (Month 25-27): B2B 영업 시작
- 학교/기업 패키지 개발
- 선생님 대시보드
- 세일즈 자료 제작
- 파일럿 고객 10개 확보

#### Q4 (Month 28-30): AI 기능 고도화
- ChatGPT API 연동 (자유 대화)
- 개인화된 학습 경로 AI
- 발음 피드백 (외부 API 연동)

**Year 2 목표**:
- 🎯 사용자 **50만명**
- 📱 iOS 앱 출시
- 💰 프리미엄 구독 시작 (전환율 2%)
- 🏢 B2B 고객 10개
- 💵 월 수익 **$5,000+**

---

### Year 3: 글로벌 확장 및 성장 (Month 31-42)

#### Q1-Q2 (Month 31-36): 다국어 지원
- 일본어 버전
- 중국어 버전
- 베트남어 버전
- 글로벌 마케팅

#### Q3-Q4 (Month 37-42): 스케일업
- React Native 재작성 (선택사항)
- 코스 마켓플레이스 오픈
- 언어 교환 기능
- API 라이선스 시작

**Year 3 목표**:
- 🎯 사용자 **100만명** (글로벌)
- 🌏 5개국 언어 지원
- 💰 월 수익 **$20,000+**
- 🏆 앱 스토어 TOP 10

---

## 🛠️ 상세 개발 로드맵 (Phase별 세분화)

### Phase 0: 개발 환경 및 데이터 수집 도구 (5-7시간)

#### Task 0.1: AI 프롬프트 라이브러리 구축 (2-3시간)

**목표**: 콘텐츠 제작을 위한 재사용 가능한 프롬프트 템플릿

```typescript
// scripts/promptLibrary.ts
export const PromptTemplates = {
  vocabulary: {
    generate: (level: string, topic: string, count: number) => `
Create a JSON array of ${count} ${level}-level English vocabulary words for "${topic}".

Requirements:
- Include fields: word, pronunciation (IPA), partOfSpeech, koreanMeaning, difficulty (1-5)
- Provide 3 real-life example sentences per word with Korean translations
- Include situational context (e.g., "at a cafe", "at work")
- Words should be practical and commonly used

Format:
[
  {
    "word": "hello",
    "pronunciation": "/həˈloʊ/",
    "partOfSpeech": "interjection",
    "koreanMeaning": "안녕하세요",
    "difficulty": 1,
    "examples": [
      {
        "sentence": "Hello! How are you?",
        "translation": "안녕하세요! 어떻게 지내세요?",
        "situation": "meeting a friend"
      }
    ]
  }
]
`,

    validate: (level: string) => `
Review this vocabulary list for ${level} learners.
Check:
1. Are all words appropriate for this level?
2. Are example sentences natural and practical?
3. Are Korean translations accurate?
4. Any cultural notes needed?

Provide feedback and suggestions.
`
  },

  dialogue: {
    generate: (situation: string, level: string, turns: number) => `
Create a natural English dialogue for ${level} learners in this situation: "${situation}".

Requirements:
- ${turns} conversational turns
- Natural, contemporary English
- Include Korean translations
- Add 2-3 comprehension questions
- Mark difficult vocabulary

Format:
{
  "title": "...",
  "situation": "...",
  "dialogue": [
    {
      "speaker": "A",
      "text": "...",
      "translation": "...",
      "notes": "..."
    }
  ],
  "questions": [...]
}
`
  },

  conversationSimulation: {
    generate: (scenario: string, level: string) => `
Create a branching conversation simulation for ${level} learners: "${scenario}".

Requirements:
- 6-8 conversational turns
- For each turn, provide 3 response options:
  1. Perfect (100% natural)
  2. Okay (grammatically correct but awkward)
  3. Wrong (unnatural or rude)
- Detailed feedback for each option explaining why
- Cultural tips where relevant
- Points: Perfect (20), Okay (14), Wrong (6)

Format:
{
  "scenario": "...",
  "turns": [
    {
      "speaker": "npc",
      "text": "...",
      "options": [
        {
          "text": "...",
          "naturalness": 100,
          "feedback": "...",
          "culturalTip": "...",
          "points": 20
        }
      ]
    }
  ]
}
`
  },

  grammar: {
    generateExplanation: (topic: string, level: string) => `
Explain this grammar topic for ${level} learners: "${topic}".

Requirements:
- Simple, clear Korean explanation
- 5-7 example sentences with translations
- Common mistakes to avoid
- Practice exercises (5 questions)

Use beginner-friendly language.
`
  }
};
```

**Task 0.2: 데이터 검증 스크립트 (2-3시간)**

```typescript
// scripts/validateData.ts
export const DataValidator = {
  vocabulary: (data: VocabularyWord[]) => {
    const errors: string[] = [];

    data.forEach((word, index) => {
      // 필수 필드 체크
      if (!word.word) errors.push(`[${index}] Missing 'word' field`);
      if (!word.pronunciation) errors.push(`[${index}] Missing pronunciation`);
      if (!word.koreanMeaning) errors.push(`[${index}] Missing Korean meaning`);

      // 예문 체크
      if (!word.examples || word.examples.length !== 3) {
        errors.push(`[${index}] Must have exactly 3 examples`);
      }

      // 난이도 범위
      if (word.difficulty < 1 || word.difficulty > 5) {
        errors.push(`[${index}] Difficulty must be 1-5`);
      }

      // IPA 발음 형식 체크
      if (!word.pronunciation.match(/^\/.*\/$/)) {
        errors.push(`[${index}] Pronunciation must be in IPA format /.../ `);
      }

      // 예문 검증
      word.examples?.forEach((ex, i) => {
        if (!ex.sentence) errors.push(`[${index}.${i}] Missing sentence`);
        if (!ex.translation) errors.push(`[${index}.${i}] Missing translation`);
        if (!ex.situation) errors.push(`[${index}.${i}] Missing situation`);
      });
    });

    return { valid: errors.length === 0, errors };
  },

  dialogue: (data: DialogueData) => {
    const errors: string[] = [];

    if (!data.title) errors.push('Missing dialogue title');
    if (!data.situation) errors.push('Missing situation description');

    if (!data.dialogue || data.dialogue.length < 3) {
      errors.push('Dialogue must have at least 3 turns');
    }

    data.dialogue?.forEach((turn, i) => {
      if (!turn.speaker) errors.push(`[Turn ${i}] Missing speaker`);
      if (!turn.text) errors.push(`[Turn ${i}] Missing text`);
      if (!turn.translation) errors.push(`[Turn ${i}] Missing translation`);
    });

    if (!data.questions || data.questions.length < 2) {
      errors.push('Must have at least 2 comprehension questions');
    }

    return { valid: errors.length === 0, errors };
  },

  conversationSimulation: (data: ConversationScenario) => {
    const errors: string[] = [];

    if (!data.scenario) errors.push('Missing scenario description');

    data.turns?.forEach((turn, i) => {
      if (!turn.speaker) errors.push(`[Turn ${i}] Missing speaker`);
      if (!turn.text) errors.push(`[Turn ${i}] Missing text`);

      if (!turn.options || turn.options.length !== 3) {
        errors.push(`[Turn ${i}] Must have exactly 3 options`);
      }

      turn.options?.forEach((opt, j) => {
        if (!opt.text) errors.push(`[Turn ${i}.${j}] Missing option text`);
        if (!opt.feedback) errors.push(`[Turn ${i}.${j}] Missing feedback`);
        if (opt.points === undefined) errors.push(`[Turn ${i}.${j}] Missing points`);

        // 점수 검증
        const validPoints = [20, 14, 6];
        if (!validPoints.includes(opt.points)) {
          errors.push(`[Turn ${i}.${j}] Points must be 20, 14, or 6`);
        }
      });
    });

    return { valid: errors.length === 0, errors };
  }
};

// 사용 예시
const validateVocabularyFile = async (filePath: string) => {
  const data = await import(filePath);
  const result = DataValidator.vocabulary(data);

  if (!result.valid) {
    console.error('❌ Validation failed:');
    result.errors.forEach(err => console.error(`  - ${err}`));
    process.exit(1);
  }

  console.log('✅ Validation passed!');
};
```

**Task 0.3: 자동 생성 스크립트 (1-2시간)**

```bash
#!/bin/bash
# scripts/generateActivity.sh

# Usage: ./generateActivity.sh vocabulary week-1 A1 "Greetings and Self-Introduction"

TYPE=$1        # vocabulary, listening, speaking, etc.
WEEK=$2        # week-1, week-2, etc.
LEVEL=$3       # A1, A2, B1, B2
TOPIC=$4       # Topic description

echo "Generating $TYPE activity for $WEEK ($LEVEL): $TOPIC"

# AI 프롬프트 실행 (Claude API 또는 ChatGPT API)
# 결과를 data/activities/$WEEK/$TYPE.json에 저장

node scripts/generateWithAI.js \
  --type=$TYPE \
  --week=$WEEK \
  --level=$LEVEL \
  --topic="$TOPIC" \
  --output="data/activities/$WEEK/$TYPE.json"

# 검증 실행
node scripts/validate.js "data/activities/$WEEK/$TYPE.json"

if [ $? -eq 0 ]; then
  echo "✅ Successfully generated and validated $TYPE activity"
else
  echo "❌ Validation failed. Please review the output."
  exit 1
fi
```

---

### Phase 1: 레벨 테스트 (15-20시간) - 매우 상세

#### Sub-Phase 1.1: 데이터 수집 (8-10시간)

**Task 1.1.1: Grammar 문제 20개 제작 (3-4시간)**

**1.1.1a: A1 Grammar (1시간)**
```typescript
// 예시 데이터 구조
const A1GrammarQuestions = [
  {
    id: 'grammar-a1-001',
    level: 'A1',
    topic: 'be-verb',
    question: 'I ___ a student.',
    options: ['am', 'is', 'are', 'be'],
    correctAnswer: 0,
    explanation: {
      korean: "'I'와 함께 사용하는 be동사는 'am'입니다.",
      english: "Use 'am' with 'I'.",
      rule: "Subject-verb agreement: I am, You are, He/She/It is"
    },
    difficulty: 1
  },
  {
    id: 'grammar-a1-002',
    level: 'A1',
    topic: 'articles',
    question: 'I have ___ apple.',
    options: ['a', 'an', 'the', '(no article)'],
    correctAnswer: 1,
    explanation: {
      korean: "'apple'은 모음으로 시작하므로 'an'을 사용합니다.",
      english: "Use 'an' before words starting with a vowel sound.",
      rule: "a + consonant sound, an + vowel sound"
    },
    difficulty: 1
  }
  // ... 3개 더
];
```

**작업 프로세스**:
1. AI 프롬프트로 초안 생성 (20분)
2. 한국인 학습자 실수 패턴 반영 (20분)
3. 설명 한국어 번역 검토 (10분)
4. JSON 파일 생성 및 검증 (10분)

**1.1.1b: A2 Grammar (1시간)**
- 과거 시제 (went, ate, saw)
- 미래 시제 (will go, be going to)
- 비교급/최상급 (bigger, biggest)
- 빈도부사 (always, usually, sometimes)
- some/any 차이

**1.1.1c: B1 Grammar (1시간)**
- 현재완료 (have been, have done)
- 조동사 (can, could, should, must)
- 가정법 과거 (If I were you...)
- 수동태 (is made, was built)
- 관계대명사 (who, which, that)

**1.1.1d: B2 Grammar (1-1.5시간)**
- 분사구문 (Walking down the street...)
- 도치 구문 (Never have I seen...)
- 가정법 과거완료 (If I had known...)
- 복합 관계대명사 (whoever, whichever)
- 시제 일치 (reported speech)

**1.1.1e: JSON 파일 생성 및 TypeScript 타입 (0.5시간)**

```typescript
// types/levelTest.ts
export interface GrammarQuestion {
  id: string;
  level: 'A1' | 'A2' | 'B1' | 'B2';
  topic: string;
  question: string;
  options: string[];
  correctAnswer: number; // 0-3 index
  explanation: {
    korean: string;
    english: string;
    rule: string;
  };
  difficulty: 1 | 2 | 3 | 4 | 5;
}

// data/levelTest/grammar.json
export const grammarQuestions: GrammarQuestion[] = [
  // ... 20 questions
];
```

---

**Task 1.1.2: Vocabulary 문제 30개 제작 (3-4시간)**

**1.1.2a: A1 Vocabulary (1시간)**

주제별 분류:
- Family (4 words): mother, father, sister, brother
- Food (4 words): apple, rice, water, bread
- Numbers (2 words): one, ten
- Colors (2 words): red, blue
- Basic verbs (4 words): go, eat, sleep, like
- Greetings (2 words): hello, goodbye

```typescript
const A1VocabQuestions = [
  {
    id: 'vocab-a1-001',
    level: 'A1',
    category: 'family',
    question: 'My ___ is a teacher. (어머니)',
    questionType: 'fill-in-blank',
    options: ['mother', 'father', 'sister', 'brother'],
    correctAnswer: 0,
    wordInfo: {
      word: 'mother',
      pronunciation: '/ˈmʌðər/',
      koreanMeaning: '어머니',
      exampleSentence: 'My mother cooks delicious food.',
      exampleTranslation: '우리 어머니는 맛있는 음식을 요리하세요.'
    },
    difficulty: 1
  },
  {
    id: 'vocab-a1-002',
    level: 'A1',
    category: 'food',
    question: 'What is this? 🍎',
    questionType: 'image-recognition',
    options: ['apple', 'orange', 'banana', 'grape'],
    correctAnswer: 0,
    image: '/images/vocab/apple.png',
    difficulty: 1
  }
];
```

**1.1.2b: A2 Vocabulary (1시간)**
- Jobs (8 words): doctor, teacher, driver, engineer
- Hobbies (4 words): reading, swimming, cooking, gaming
- Weather (4 words): sunny, rainy, cloudy, snowy
- Places (4 words): school, hospital, park, store
- Transportation (4 words): bus, train, car, bike

**1.1.2c: B1 Vocabulary (1시간)**
- Abstract concepts (3 words): freedom, justice, democracy
- Emotions (3 words): jealous, anxious, grateful
- Opinions (3 words): agree, disagree, argue
- Society (4 words): community, culture, tradition, citizen

**1.1.2d: B2 Vocabulary (1시간)**
- Idioms (3 words): "piece of cake", "break the ice"
- Business (2 words): deadline, meeting
- Academic (2 words): research, analysis
- News (2 words): conflict, election

---

**Task 1.1.3: Listening 스크립트 10개 (2-2.5시간)**

**1.1.3a: A1-A2 대화 5개 (1-1.5시간)**

**대화 1: 카페 주문 (15분)**
```json
{
  "id": "listening-a1-001",
  "level": "A1-A2",
  "title": "Ordering Coffee",
  "situation": "At Starbucks - ordering for the first time",
  "duration": "15 seconds",
  "speakers": ["Customer", "Barista"],
  "dialogue": [
    {
      "speaker": "Barista",
      "text": "Hi! Welcome to Starbucks. What can I get for you?",
      "translation": "안녕하세요! 스타벅스에 오신 것을 환영합니다. 무엇을 드릴까요?",
      "notes": "'What can I get for you?' = 주문 받을 때 표준 표현"
    },
    {
      "speaker": "Customer",
      "text": "Hi! Can I get a tall latte, please?",
      "translation": "안녕하세요! 톨 사이즈 라떼 하나 주세요.",
      "notes": "'Can I get...' = 자연스러운 주문 표현"
    },
    {
      "speaker": "Barista",
      "text": "Sure! Hot or iced?",
      "translation": "네! 뜨거운 거요, 차가운 거요?",
      "notes": ""
    },
    {
      "speaker": "Customer",
      "text": "Hot, please.",
      "translation": "뜨거운 걸로 주세요.",
      "notes": ""
    }
  ],
  "vocabulary": [
    { "word": "order", "meaning": "주문하다" },
    { "word": "latte", "meaning": "라떼" },
    { "word": "iced", "meaning": "차가운, 얼음 들어간" }
  ],
  "questions": [
    {
      "question": "What does the customer order?",
      "options": ["Latte", "Coffee", "Tea", "Juice"],
      "correctAnswer": 0,
      "explanation": "고객이 'latte'를 주문했습니다."
    },
    {
      "question": "Does the customer want hot or iced?",
      "options": ["Hot", "Iced", "Both", "Not mentioned"],
      "correctAnswer": 0,
      "explanation": "고객이 'Hot, please'라고 답했습니다."
    }
  ]
}
```

**대화 2-5** (각 15-20분):
- 대화 2: 길 묻기 (Asking for directions)
- 대화 3: 전화 통화 (Phone call)
- 대화 4: 쇼핑 (Shopping)
- 대화 5: 자기소개 (Self-introduction)

**1.1.3b: B1-B2 대화 5개 (1시간)**
- 대화 6: 뉴스 요약 (News summary)
- 대화 7: 직장 회의 (Office meeting)
- 대화 8: 인터뷰 (Job interview)
- 대화 9: 학술 토론 (Academic discussion)
- 대화 10: 전화 상담 (Customer service)

**1.1.3c: TTS 음성 테스트 (0.5시간)**
```typescript
// hooks/useTTS.ts 활용
import { useTTS } from '@/hooks/useTTS';

const TestListeningAudio = () => {
  const { speak, speakSlow, speakNormal } = useTTS();

  const testDialogue = async () => {
    // 느린 속도로 먼저
    await speakSlow("Hi! Welcome to Starbucks.");
    await new Promise(r => setTimeout(r, 500)); // 0.5초 대기

    // 보통 속도
    await speakNormal("Hi! Welcome to Starbucks.");
  };

  // 모든 대화 테스트
  // 발음 이상한 단어 수정
  // 속도 조정
};
```

---

#### Sub-Phase 1.2: UI/UX 구현 (4-6시간)

**Task 1.2.1: 시작 페이지 (1-1.5시간)**

```tsx
// app/level-test/page.tsx
export default function LevelTestPage() {
  const [isStarted, setIsStarted] = useState(false);

  if (isStarted) {
    return <LevelTestQuestions />;
  }

  return (
    <div className="max-w-2xl mx-auto py-12 px-4">
      {/* 헤더 */}
      <div className="text-center mb-12">
        <h1 className="text-4xl font-bold mb-4">
          당신의 영어 실력을 확인하세요
        </h1>
        <p className="text-gray-600 text-lg">
          정확한 레벨 테스트로 맞춤형 학습을 시작하세요
        </p>
      </div>

      {/* 테스트 구성 */}
      <div className="bg-white rounded-lg shadow-lg p-8 mb-8">
        <h2 className="text-2xl font-semibold mb-6">테스트 구성</h2>
        <div className="space-y-4">
          <TestSection
            icon="📝"
            title="Grammar"
            description="문법 문제 20개"
            duration="7-10분"
          />
          <TestSection
            icon="📚"
            title="Vocabulary"
            description="어휘 문제 30개"
            duration="10-12분"
          />
          <TestSection
            icon="🎧"
            title="Listening"
            description="듣기 대화 10개"
            duration="8-10분"
          />
        </div>

        <div className="mt-6 p-4 bg-blue-50 rounded-lg">
          <p className="text-sm text-blue-800">
            <strong>예상 소요 시간:</strong> 25-30분<br />
            <strong>문제 수:</strong> 총 60문제<br />
            <strong>결과:</strong> 즉시 확인 (A1/A2/B1/B2 레벨 판정)
          </p>
        </div>
      </div>

      {/* 주의사항 */}
      <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8">
        <h3 className="font-semibold mb-2">⚠️ 주의사항</h3>
        <ul className="text-sm space-y-1 text-gray-700">
          <li>• 조용한 장소에서 테스트를 진행하세요</li>
          <li>• 듣기 문제는 헤드폰 사용을 권장합니다</li>
          <li>• 정직하게 답변해주세요 (학습 효과가 더 좋습니다)</li>
          <li>• 중간에 멈추지 말고 한 번에 완료해주세요</li>
        </ul>
      </div>

      {/* 시작 버튼 */}
      <button
        onClick={() => setIsStarted(true)}
        className="w-full bg-indigo-600 text-white py-4 rounded-lg text-lg font-semibold hover:bg-indigo-700 transition"
      >
        테스트 시작하기 →
      </button>
    </div>
  );
}

const TestSection = ({ icon, title, description, duration }) => (
  <div className="flex items-center space-x-4 p-4 border rounded-lg">
    <div className="text-4xl">{icon}</div>
    <div className="flex-1">
      <h3 className="font-semibold text-lg">{title}</h3>
      <p className="text-gray-600 text-sm">{description}</p>
    </div>
    <div className="text-gray-500 text-sm">{duration}</div>
  </div>
);
```

**Task 1.2.2: 문제 풀이 UI (2-3시간)**

```tsx
// components/LevelTestQuestions.tsx
export function LevelTestQuestions() {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState<number[]>([]);
  const [section, setSection] = useState<'grammar' | 'vocabulary' | 'listening'>('grammar');

  const totalQuestions = 60;
  const progress = ((currentQuestion + 1) / totalQuestions) * 100;

  return (
    <div className="max-w-3xl mx-auto py-8 px-4">
      {/* 진행률 바 */}
      <div className="mb-8">
        <div className="flex justify-between mb-2">
          <span className="text-sm font-medium">
            문제 {currentQuestion + 1} / {totalQuestions}
          </span>
          <span className="text-sm text-gray-600">
            {progress.toFixed(0)}% 완료
          </span>
        </div>
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className="bg-indigo-600 h-2 rounded-full transition-all duration-300"
            style={{ width: `${progress}%` }}
          />
        </div>
      </div>

      {/* 섹션 표시 */}
      <div className="mb-6">
        <span className="inline-block px-4 py-2 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium">
          {section === 'grammar' && '📝 Grammar'}
          {section === 'vocabulary' && '📚 Vocabulary'}
          {section === 'listening' && '🎧 Listening'}
        </span>
      </div>

      {/* 문제 */}
      {section === 'grammar' && (
        <GrammarQuestion
          question={grammarQuestions[currentQuestion]}
          onAnswer={(answer) => handleAnswer(answer)}
        />
      )}

      {section === 'vocabulary' && (
        <VocabularyQuestion
          question={vocabularyQuestions[currentQuestion - 20]}
          onAnswer={(answer) => handleAnswer(answer)}
        />
      )}

      {section === 'listening' && (
        <ListeningQuestion
          question={listeningQuestions[currentQuestion - 50]}
          onAnswer={(answer) => handleAnswer(answer)}
        />
      )}
    </div>
  );
}

// Grammar 문제 컴포넌트
const GrammarQuestion = ({ question, onAnswer }) => (
  <div className="bg-white rounded-lg shadow-lg p-8">
    <h2 className="text-2xl font-semibold mb-6">{question.question}</h2>

    <div className="space-y-3">
      {question.options.map((option, index) => (
        <button
          key={index}
          onClick={() => onAnswer(index)}
          className="w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition"
        >
          <span className="font-medium mr-3">
            {String.fromCharCode(65 + index)}.
          </span>
          {option}
        </button>
      ))}
    </div>
  </div>
);

// Listening 문제 컴포넌트
const ListeningQuestion = ({ question, onAnswer }) => {
  const { speak, speakSlow, isSpeaking } = useTTS();
  const [showScript, setShowScript] = useState(false);

  const playDialogue = async (speed: 'slow' | 'normal') => {
    for (const line of question.dialogue) {
      if (speed === 'slow') {
        await speakSlow(line.text);
      } else {
        await speak(line.text);
      }
      await new Promise(r => setTimeout(r, 800)); // 0.8초 대기
    }
  };

  return (
    <div className="bg-white rounded-lg shadow-lg p-8">
      {/* 상황 설명 */}
      <div className="mb-6 p-4 bg-blue-50 rounded-lg">
        <p className="text-sm text-blue-800">
          <strong>상황:</strong> {question.situation}
        </p>
      </div>

      {/* 오디오 플레이어 */}
      <div className="flex items-center justify-center space-x-4 mb-6">
        <button
          onClick={() => playDialogue('slow')}
          disabled={isSpeaking}
          className="px-6 py-3 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 disabled:opacity-50"
        >
          🐢 느리게 듣기
        </button>
        <button
          onClick={() => playDialogue('normal')}
          disabled={isSpeaking}
          className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50"
        >
          ▶️ 보통 속도
        </button>
      </div>

      {/* 스크립트 보기 버튼 */}
      <button
        onClick={() => setShowScript(!showScript)}
        className="text-sm text-gray-600 underline mb-6"
      >
        {showScript ? '스크립트 숨기기' : '스크립트 보기'}
      </button>

      {showScript && (
        <div className="mb-6 p-4 bg-gray-50 rounded-lg space-y-3">
          {question.dialogue.map((line, i) => (
            <div key={i}>
              <p className="font-semibold text-sm text-gray-700">
                {line.speaker}:
              </p>
              <p className="text-gray-900">{line.text}</p>
              <p className="text-sm text-gray-600 italic">{line.translation}</p>
            </div>
          ))}
        </div>
      )}

      {/* 질문 */}
      <h3 className="text-xl font-semibold mb-4">{question.questions[0].question}</h3>

      <div className="space-y-3">
        {question.questions[0].options.map((option, index) => (
          <button
            key={index}
            onClick={() => onAnswer(index)}
            className="w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition"
          >
            {option}
          </button>
        ))}
      </div>
    </div>
  );
};
```

**Task 1.2.3: 결과 화면 (1-1.5시간)**

```tsx
// components/LevelTestResult.tsx
export function LevelTestResult({ scores, userLevel }) {
  const chartData = {
    labels: ['Grammar', 'Vocabulary', 'Listening'],
    datasets: [{
      label: 'Your Score',
      data: [scores.grammar, scores.vocabulary, scores.listening],
      backgroundColor: 'rgba(79, 70, 229, 0.2)',
      borderColor: 'rgba(79, 70, 229, 1)',
      borderWidth: 2,
    }]
  };

  return (
    <div className="max-w-4xl mx-auto py-12 px-4">
      {/* 축하 메시지 */}
      <div className="text-center mb-12">
        <div className="inline-block px-6 py-3 bg-green-100 text-green-800 rounded-full mb-4">
          🎉 테스트 완료!
        </div>
        <h1 className="text-4xl font-bold mb-4">
          당신의 레벨은 <span className="text-indigo-600">{userLevel.level}</span>입니다
        </h1>
        <p className="text-gray-600 text-lg">
          {getLevelDescription(userLevel.level)}
        </p>
      </div>

      {/* 점수 카드 */}
      <div className="grid grid-cols-3 gap-6 mb-12">
        <ScoreCard
          title="Grammar"
          score={scores.grammar}
          total={20}
          icon="📝"
          color="blue"
        />
        <ScoreCard
          title="Vocabulary"
          score={scores.vocabulary}
          total={30}
          icon="📚"
          color="green"
        />
        <ScoreCard
          title="Listening"
          score={scores.listening}
          total={10}
          icon="🎧"
          color="purple"
        />
      </div>

      {/* 레이더 차트 */}
      <div className="bg-white rounded-lg shadow-lg p-8 mb-12">
        <h2 className="text-2xl font-semibold mb-6 text-center">영역별 분석</h2>
        <div className="max-w-md mx-auto">
          <Radar data={chartData} options={radarOptions} />
        </div>
      </div>

      {/* 강점/약점 */}
      <div className="grid grid-cols-2 gap-6 mb-12">
        <div className="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
          <h3 className="font-semibold text-lg mb-3 text-green-800">
            💪 강점
          </h3>
          <ul className="space-y-2 text-green-700">
            {userLevel.strengths.map((strength, i) => (
              <li key={i}>• {strength}</li>
            ))}
          </ul>
        </div>

        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-lg">
          <h3 className="font-semibold text-lg mb-3 text-yellow-800">
            📈 개선 필요
          </h3>
          <ul className="space-y-2 text-yellow-700">
            {userLevel.weaknesses.map((weakness, i) => (
              <li key={i}>• {weakness}</li>
            ))}
          </ul>
        </div>
      </div>

      {/* 추천 Week */}
      <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-lg p-8 text-white mb-12">
        <h2 className="text-2xl font-semibold mb-4">당신에게 추천하는 학습</h2>
        <p className="mb-6 text-indigo-100">
          당신의 레벨에 맞춰 <strong>{userLevel.startWeek}</strong>부터 시작하는 것을 추천합니다.
        </p>
        <Link href={`/learn/${userLevel.startWeek}`}>
          <button className="bg-white text-indigo-600 px-8 py-3 rounded-lg font-semibold hover:bg-indigo-50 transition">
            학습 시작하기 →
          </button>
        </Link>
      </div>

      {/* 결과 저장 버튼 */}
      <div className="text-center">
        <button
          onClick={() => saveLevelTestResult(userId, userLevel)}
          className="bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-700 transition"
        >
          결과 저장하기
        </button>
      </div>
    </div>
  );
}

const ScoreCard = ({ title, score, total, icon, color }) => (
  <div className={`bg-${color}-50 rounded-lg p-6 text-center`}>
    <div className="text-4xl mb-2">{icon}</div>
    <h3 className="font-semibold text-lg mb-2">{title}</h3>
    <div className="text-3xl font-bold text-${color}-600">
      {score} <span className="text-lg text-gray-600">/ {total}</span>
    </div>
    <div className="text-sm text-gray-600 mt-1">
      {((score / total) * 100).toFixed(0)}% 정답
    </div>
  </div>
);

const getLevelDescription = (level: string) => {
  const descriptions = {
    'A1': '기초 수준입니다. 기본적인 인사와 간단한 문장을 이해할 수 있습니다.',
    'A2': '초급 수준입니다. 일상적인 대화와 간단한 의사소통이 가능합니다.',
    'B1': '중급 수준입니다. 친숙한 주제에 대해 자신감 있게 대화할 수 있습니다.',
    'B2': '중상급 수준입니다. 복잡한 주제도 유창하게 토론할 수 있습니다.'
  };
  return descriptions[level] || '';
};
```

---

#### Sub-Phase 1.3: 로직 구현 (3-4시간)

**Task 1.3.1: 테스트 진행 로직 (1.5-2시간)**

```typescript
// hooks/useLevelTest.ts
export const useLevelTest = () => {
  const [currentSection, setCurrentSection] = useState<'grammar' | 'vocabulary' | 'listening'>('grammar');
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState<number[]>([]);
  const [startTime, setStartTime] = useState<Date | null>(null);
  const [sectionStartTimes, setSectionStartTimes] = useState<Record<string, Date>>({});

  // 테스트 시작
  const startTest = () => {
    setStartTime(new Date());
    setSectionStartTimes({ grammar: new Date() });
  };

  // 답안 제출
  const submitAnswer = (answerIndex: number) => {
    setAnswers([...answers, answerIndex]);
    moveToNextQuestion();
  };

  // 다음 문제로
  const moveToNextQuestion = () => {
    const totalInSection = getSectionQuestionCount(currentSection);

    if (currentQuestionIndex + 1 < totalInSection) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
    } else {
      // 다음 섹션으로
      moveToNextSection();
    }
  };

  // 다음 섹션으로
  const moveToNextSection = () => {
    if (currentSection === 'grammar') {
      setCurrentSection('vocabulary');
      setCurrentQuestionIndex(0);
      setSectionStartTimes(prev => ({ ...prev, vocabulary: new Date() }));
    } else if (currentSection === 'vocabulary') {
      setCurrentSection('listening');
      setCurrentQuestionIndex(0);
      setSectionStartTimes(prev => ({ ...prev, listening: new Date() }));
    } else {
      // 테스트 완료
      finishTest();
    }
  };

  // 테스트 완료
  const finishTest = async () => {
    const endTime = new Date();
    const totalTime = endTime.getTime() - startTime!.getTime();

    // 채점
    const scores = gradeTest(answers);

    // 레벨 판정
    const userLevel = evaluateLevel(scores);

    // Firestore 저장
    await saveLevelTestResult(userId, {
      scores,
      userLevel,
      answers,
      totalTime,
      sectionTimes: calculateSectionTimes(sectionStartTimes, endTime),
      completedAt: endTime
    });

    return { scores, userLevel };
  };

  return {
    currentSection,
    currentQuestionIndex,
    submitAnswer,
    startTest,
    progress: calculateProgress(currentSection, currentQuestionIndex)
  };
};

const getSectionQuestionCount = (section: string) => {
  return {
    grammar: 20,
    vocabulary: 30,
    listening: 10
  }[section] || 0;
};

const calculateProgress = (section: string, index: number) => {
  const sectionStarts = {
    grammar: 0,
    vocabulary: 20,
    listening: 50
  };

  const currentQuestion = sectionStarts[section] + index;
  return (currentQuestion / 60) * 100;
};
```

**Task 1.3.2: 채점 및 레벨 판정 (1-1.5시간)**

```typescript
// lib/levelTest/grading.ts
export const gradeTest = (answers: number[]): TestScores => {
  const grammarAnswers = answers.slice(0, 20);
  const vocabularyAnswers = answers.slice(20, 50);
  const listeningAnswers = answers.slice(50, 60);

  const grammarScore = grammarAnswers.filter((answer, i) =>
    answer === grammarQuestions[i].correctAnswer
  ).length;

  const vocabularyScore = vocabularyAnswers.filter((answer, i) =>
    answer === vocabularyQuestions[i].correctAnswer
  ).length;

  const listeningScore = listeningAnswers.filter((answer, i) =>
    answer === listeningQuestions[i].correctAnswer
  ).length;

  return {
    grammar: grammarScore,
    vocabulary: vocabularyScore,
    listening: listeningScore,
    total: grammarScore + vocabularyScore + listeningScore
  };
};

// lib/levelTest/evaluation.ts
export const evaluateLevel = (scores: TestScores): UserLevel => {
  // 각 영역별 레벨 계산
  const grammarLevel = calculateGrammarLevel(scores.grammar);
  const vocabLevel = calculateVocabLevel(scores.vocabulary);
  const listeningLevel = calculateListeningLevel(scores.listening);

  // 가장 낮은 레벨을 시작점으로 (안전한 접근)
  const levels = [grammarLevel, vocabLevel, listeningLevel];
  const minLevel = Math.min(...levels);
  const maxLevel = Math.max(...levels);

  // CEFR 레벨 매핑
  const cefrLevel = mapToCEFR(minLevel);

  // 추천 Week 계산
  const startWeek = getRecommendedWeek(cefrLevel);

  // 강점/약점 분석
  const strengths = analyzeStrengths(scores);
  const weaknesses = analyzeWeaknesses(scores);

  return {
    level: cefrLevel,
    startWeek,
    scores,
    strengths,
    weaknesses,
    levelDistribution: {
      grammar: mapToCEFR(grammarLevel),
      vocabulary: mapToCEFR(vocabLevel),
      listening: mapToCEFR(listeningLevel)
    }
  };
};

const calculateGrammarLevel = (score: number): number => {
  // 20문제 기준
  // 0-5: Level 1 (A1)
  // 6-10: Level 2 (A2)
  // 11-15: Level 3 (B1)
  // 16-20: Level 4 (B2)
  if (score <= 5) return 1;
  if (score <= 10) return 2;
  if (score <= 15) return 3;
  return 4;
};

const calculateVocabLevel = (score: number): number => {
  // 30문제 기준
  if (score <= 8) return 1;   // A1
  if (score <= 16) return 2;  // A2
  if (score <= 23) return 3;  // B1
  return 4;                    // B2
};

const calculateListeningLevel = (score: number): number => {
  // 10문제 기준
  if (score <= 2) return 1;
  if (score <= 5) return 2;
  if (score <= 7) return 3;
  return 4;
};

const mapToCEFR = (level: number): CEFRLevel => {
  const mapping = {
    1: 'A1',
    2: 'A2',
    3: 'B1',
    4: 'B2'
  };
  return mapping[level] || 'A1';
};

const getRecommendedWeek = (level: CEFRLevel): string => {
  const weekMapping = {
    'A1': 'week-1',
    'A2': 'week-3',
    'B1': 'week-5',
    'B2': 'week-7'
  };
  return weekMapping[level] || 'week-1';
};

const analyzeStrengths = (scores: TestScores): string[] => {
  const strengths: string[] = [];
  const { grammar, vocabulary, listening } = scores;

  const percentages = {
    grammar: (grammar / 20) * 100,
    vocabulary: (vocabulary / 30) * 100,
    listening: (listening / 10) * 100
  };

  // 70% 이상이면 강점
  if (percentages.grammar >= 70) {
    strengths.push('문법 기초가 탄탄합니다');
  }
  if (percentages.vocabulary >= 70) {
    strengths.push('어휘력이 풍부합니다');
  }
  if (percentages.listening >= 70) {
    strengths.push('듣기 능력이 우수합니다');
  }

  if (strengths.length === 0) {
    strengths.push('기초부터 차근차근 배워나가면 됩니다');
  }

  return strengths;
};

const analyzeWeaknesses = (scores: TestScores): string[] => {
  const weaknesses: string[] = [];
  const { grammar, vocabulary, listening } = scores;

  const percentages = {
    grammar: (grammar / 20) * 100,
    vocabulary: (vocabulary / 30) * 100,
    listening: (listening / 10) * 100
  };

  // 50% 미만이면 약점
  if (percentages.grammar < 50) {
    weaknesses.push('문법 연습이 필요합니다');
  }
  if (percentages.vocabulary < 50) {
    weaknesses.push('어휘력 향상이 필요합니다');
  }
  if (percentages.listening < 50) {
    weaknesses.push('듣기 연습을 더 하면 좋겠습니다');
  }

  if (weaknesses.length === 0) {
    weaknesses.push('전반적으로 균형잡힌 실력입니다');
  }

  return weaknesses;
};
```

**Task 1.3.3: Firestore 저장 (0.5-1시간)**

```typescript
// lib/levelTest/saveLevelTestResult.ts
import { doc, setDoc, serverTimestamp } from 'firebase/firestore';
import { db } from '@/lib/firebase';

export interface LevelTestResult {
  userId: string;
  level: CEFRLevel;
  startWeek: string;
  scores: TestScores;
  answers: number[];
  strengths: string[];
  weaknesses: string[];
  levelDistribution: {
    grammar: CEFRLevel;
    vocabulary: CEFRLevel;
    listening: CEFRLevel;
  };
  totalTime: number; // milliseconds
  sectionTimes: {
    grammar: number;
    vocabulary: number;
    listening: number;
  };
  completedAt: Date;
  testVersion: string;
}

export const saveLevelTestResult = async (
  userId: string,
  result: Omit<LevelTestResult, 'userId' | 'testVersion'>
) => {
  try {
    const docRef = doc(db, 'levelTestResults', userId);

    await setDoc(docRef, {
      userId,
      ...result,
      testVersion: '1.0',
      savedAt: serverTimestamp()
    });

    console.log('✅ Level test result saved successfully');
    return true;
  } catch (error) {
    console.error('❌ Error saving level test result:', error);
    throw error;
  }
};

// 결과 조회 Hook
export const useLevelTestResult = (userId?: string) => {
  return useQuery({
    queryKey: ['levelTestResult', userId],
    queryFn: async () => {
      if (!userId) return null;

      const docRef = doc(db, 'levelTestResults', userId);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        return docSnap.data() as LevelTestResult;
      }

      return null;
    },
    enabled: !!userId,
    staleTime: 1000 * 60 * 60 // 1시간 캐시
  });
};
```

---

## 다음 단계

이제 **완전한 종합 마스터 플랜**이 준비되었습니다!

**파일 요약**:
1. `docs/COMPREHENSIVE_FEATURE_PLAN.md` - 12개 Phase 개요
2. `docs/DETAILED_EXECUTION_PLAN.md` - Phase 세분화 + 데이터 수집 전략
3. `docs/ULTIMATE_MASTER_PLAN.md` - **현재 ~ 3년 후 완전 전략** ⭐

**다음 작업**:
1. Phase 1.1.1a부터 시작 (Grammar A1 문제 5개 제작, 1시간)
2. AI 프롬프트로 초안 생성
3. 검증 및 JSON 파일 생성

시작할까요?
